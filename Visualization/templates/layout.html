<!DOCTYPE html>
<!-- saved from url=(0055)http://bost.ocks.org/mike/cubism/intro/demo-stocks.html -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<style>
body {
    font-family: "Helvetica Neue", Helvetica, sans-serif;
    margin: 30px auto;
    width: 1280px;
    position: relative;
}

header {
    padding: 6px 0;
}

.group {
    margin-bottom: 1em;
}

.axis {
    font: 10px sans-serif;
    position: fixed;
    pointer-events: none;
    z-index: 2;
}

.axis text {
    -webkit-transition: fill-opacity 250ms linear;
}

.axis path {
    display: none;
}

.axis line {
    stroke: #000;
    shape-rendering: crispEdges;
}

.axis.top {
    background-image: linear-gradient(top, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -o-linear-gradient(top, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -moz-linear-gradient(top, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -webkit-linear-gradient(top, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -ms-linear-gradient(top, #fff 0%, rgba(255,255,255,0) 100%);
    top: 0px;
    padding: 0 0 24px 0;
}

.axis.bottom {
    background-image: linear-gradient(bottom, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -o-linear-gradient(bottom, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -moz-linear-gradient(bottom, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -webkit-linear-gradient(bottom, #fff 0%, rgba(255,255,255,0) 100%);
    background-image: -ms-linear-gradient(bottom, #fff 0%, rgba(255,255,255,0) 100%);
    bottom: 0px;
    padding: 24px 0 0 0;
}

.horizon {
    border-bottom: solid 1px #000;
    overflow: hidden;
    position: relative;
}

.horizon {
    border-top: solid 1px #000;
    border-bottom: solid 1px #000;
}

.horizon + .horizon {
    border-top: none;
}

.horizon canvas {
    display: block;
}

.horizon .title,
.horizon .value {
    bottom: 0;
    line-height: 30px;
    margin: 0 6px;
    position: absolute;
    text-shadow: 0 1px 0 rgba(255,255,255,.5);
    white-space: nowrap;
}

.horizon .title {
    left: 0;
}

.horizon .value {
    right: 0;
}

.line {
    background: #000;
    z-index: 2;
}
</style>
<script src="static/js/d3.v3.min.js"></script>
<script src="static/js/cubism.v1.min.js"></script>
<!--     <style type="text/css">#yddContainer{display:block;font-family:Microsoft YaHei;position:relative;width:100%;height:100%;top:-4px;left:-4px;font-size:12px;border:1px solid}#yddTop{display:block;height:22px}#yddTopBorderlr{display:block;position:static;height:17px;padding:2px 28px;line-height:17px;font-size:12px;color:#5079bb;font-weight:bold;border-style:none solid;border-width:1px}#yddTopBorderlr .ydd-sp{position:absolute;top:2px;height:0;overflow:hidden}.ydd-icon{left:5px;width:17px;padding:0px 0px 0px 0px;padding-top:17px;background-position:-16px -44px}.ydd-close{right:5px;width:16px;padding-top:16px;background-position:left -44px}#yddKeyTitle{float:left;text-decoration:none}#yddMiddle{display:block;margin-bottom:10px}.ydd-tabs{display:block;margin:5px 0;padding:0 5px;height:18px;border-bottom:1px solid}.ydd-tab{display:block;float:left;height:18px;margin:0 5px -1px 0;padding:0 4px;line-height:18px;border:1px solid;border-bottom:none}.ydd-trans-container{display:block;line-height:160%}.ydd-trans-container a{text-decoration:none;}#yddBottom{position:absolute;bottom:0;left:0;width:100%;height:22px;line-height:22px;overflow:hidden;background-position:left -22px}.ydd-padding010{padding:0 10px}#yddWrapper{color:#252525;z-index:10001;background:url(chrome-extension://eopjamdnofihpioajgfdikhhbobonhbb/ab20.png);}#yddContainer{background:#fff;border-color:#4b7598}#yddTopBorderlr{border-color:#f0f8fc}#yddWrapper .ydd-sp{background-image:url(chrome-extension://eopjamdnofihpioajgfdikhhbobonhbb/ydd-sprite.png)}#yddWrapper a,#yddWrapper a:hover,#yddWrapper a:visited{color:#50799b}#yddWrapper .ydd-tabs{color:#959595}.ydd-tabs,.ydd-tab{background:#fff;border-color:#d5e7f3}#yddBottom{color:#363636}#yddWrapper{min-width:250px;max-width:400px;}-->
<!--</style>-->
</head>
<!--, "BIDU", "SINA", "GOOG", "MSFT", "YHOO", "ADBE", "REDF", "INSP", "IACI"-->

<body id="demo">
<script>
var context = cubism.context()
    .serverDelay(new Date(2012, 4, 2) - Date.now())
    .step(864e5)
.size(1280)
    .stop();

<!--            d3.select("#demo").selectAll(".axis")-->
    <!--.data(["top", "bottom"])-->
    <!--.enter().append("div")-->
    <!--.attr("class", function(d) { return d + " axis"; })-->
    <!--.each(function(d) { d3.select(this).call(context.axis().ticks(12).orient(d)); });-->

    d3.select("body").append("div")
    .attr("class", "rule")
    .call(context.rule());

    d3.select("body").selectAll(".horizon")
    .data(["AAPL", "BIDU"].map(stock))
    .enter().insert("div", ".bottom")
    .attr("class", "horizon")
.call(context.horizon()
        .format(d3.format("+,.2p")));

    context.on("focus", function(i) {
            d3.selectAll(".value").style("right", i == null ? null : context.size() - i + "px");
            });

// Replace this with context.graphite and graphite.metric!<!--filter(function(d) { return d[1]; }).-->
function stock(name) {
    var format = d3.time.format("%d-%b-%y");
    var first = true
    return context.metric(function(start, stop, step, callback) {
            console.log(start)
            console.log(stop)
            console.log(step)
            var maxVal = 0, maxD = 0
            d3.csv("static/csv/" + name + ".csv", function(rows) {
                rows = rows.map(function(d) { return [format.parse(d.Date), +d.Open]; }).filter(function(d) { return d[1]; }).reverse();
                var date = rows[0][0], compare = rows[400][1], value = rows[0][1], values = [value];
                rows.forEach(function(d) {
                    while ((date = d3.time.day.offset(date, 1)) < d[0]) {
                        values.push(value);
                        console.log("fuck: ", value)
                    }
                    if (d[1] > maxD) {
                        maxD = d[1]
                        maxVal = (maxD - compare) / compare
                    }
                    values.push(value = (d[1] - compare) / compare);
//                    values.push(d[1])
                    });
//                values = values.slice(-context.size())
                console.log(maxD, maxVal)
                console.log(compare)
                console.log(values[values.length - 1])
                console.log(values[values.length - 1280])
                callback(null, values.slice(-context.size()));
                });
            }, name);
}
</script>

<div class="horizon">
    <span class="title">AAPL</span>
    <span class="value">+590%</span>
</div>
<div class="horizon">
    <span class="title">BIDU</span>
    <span class="value">+1,100%</span>
</div>
<!--<div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">SINA</span><span class="value">+150%</span></div>
    <div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">GOOG</span><span class="value">+120%</span></div>
    <div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">MSFT</span><span class="value">+77%</span></div>
    <div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">YHOO</span><span class="value">+70%</span></div>
    <div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">ADBE</span><span class="value">+57%</span></div>
    <div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">REDF</span><span class="value">+210%</span></div>
    <div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">INSP</span><span class="value">+61%</span>
    </div>
    <div class="horizon"><canvas width="1280" height="30"></canvas><span class="title">IACI</span><span class="value">+230%</span>
    </div>
    -->
    <div class="rule">
        <div class="line" style="position: absolute; top: 0px; bottom: 0px; width: 1px; pointer-events: none; display: none;">
        </div>
    </div>

</body>
</html>
